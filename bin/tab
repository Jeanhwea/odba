#!/bin/bash
HERE=$(cd $(dirname $0); pwd)
ROOT=$(git -C ${HERE} rev-parse --show-toplevel)

source "${ROOT}/bin/setup"

cd ${ROOT} && echo "Connect to ${conn} in $(pwd)"
tabs=($(sqlplus -SL ${conn} < dt.sql | sed '1,/---/d' | awk '{print $1}'))

while [ ${#tabs[@]} -gt 0 ]; do
  select tab in ${tabs[@]}; do break; done
  if [ "${tab}" != '' ]; then
    echo 'exit' | sqlplus -SL ${conn} @t ${tab} && break
  else
    read -p 'filter with: ' ans
    tabs=($(echo ${tabs[@]} | tr ' ' '\n' | grep -i "${ans}"))
    if [ ${#tabs[@]} -eq 1 ]; then
      echo 'exit' | sqlplus -SL ${conn} @t ${tabs[0]} && break
    fi
  fi
done
