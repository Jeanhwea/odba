#!/bin/bash
HERE=$(cd $(dirname $0); pwd)
ROOT=$(git -C ${HERE} rev-parse --show-toplevel)

source "${ROOT}/bin/setup"

cd ${ROOT} && echo "Connect to ${conn} in $(pwd)"
tabs=($(sqlplus -SL ${conn} < dt.sql | sed '1,/---/d' | awk '{print $1}'))

PS3='Enter number to select, s to skip: '
while [ ${#tabs[@]} -gt 0 ]; do
  select tab in ${tabs[@]}; do 
    if [ "${tab}" == '' ]; then
      echo "${REPLY}"
    fi
  done
  if [ "${tab}" != '' ]; then
    yes 'exit' | sqlplus -SL ${conn} @t ${tab} && break
  else
    read -p 'Filter tables with: ' ans
    tabs=($(echo ${tabs[@]} | tr ' ' '\n' | grep -i "${ans}"))
    if [ ${#tabs[@]} -eq 1 ]; then
      yes 'exit' | sqlplus -SL ${conn} @t ${tabs[0]} && break
    fi
  fi
done
